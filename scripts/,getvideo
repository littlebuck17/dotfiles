#!/bin/bash

cd ${HOME}/Movies
sudo /usr/local/bin/yt-dlp -U
#filename=$(/usr/local/bin/yt-dlp --cookies ${HOME}/cookies.SocialMedia.txt --user-agent facebookexternalhit/1.1 --windows-filenames --get-filename "${1}")
filename=$(/usr/local/bin/yt-dlp --user-agent facebookexternalhit/1.1 --windows-filenames --get-filename "${1}")
#filename="@StarTrekGuy  [7304431911953255722].mp4"

fullname=$(echo -n "${filename%.*}" | sed -e 's/[^[:alnum:]]/-/g' | tr -s '-' | sed -e 's/^-//' | sed -e 's/-$//')
videoid="${fullname##*-}"
name="${fullname%-*}"
ext="${filename##*.}"
file="${name:0:40}-${videoid}.${ext}"

echo "${name} - ${videoid} - ${ext} - ${file}"

#/usr/local/bin/yt-dlp --cookies ${HOME}/cookies.SocialMedia.txt --user-agent facebookexternalhit/1.1 --windows-filenames -o "${file}" "${1}"
/usr/local/bin/yt-dlp --user-agent facebookexternalhit/1.1 --windows-filenames -o "${file}" "${1}"

telegram-send --video "${file}" --caption "${filename}"
